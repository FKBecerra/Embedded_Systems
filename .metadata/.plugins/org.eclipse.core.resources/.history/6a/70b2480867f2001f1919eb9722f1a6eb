/*
 * RCC.c
 *
 *  Created on: Feb 23, 2025
 *      Author: Francisco Becerra
 */

#include "RCC.h"

void SystemClock(void){
	RCC->PLLCFGR &= ~(RCC_PLLCFGR_PLLM | RCC_PLLCFGR_PLLN | RCC_PLLCFGR_PLLP);
	RCC->PLLCFGR |= (PLL_N<<6) | (PLL_P<<16) | (PLL_M<<0);

	RCC->CR |= RCC_CR_HSEON;
	while((RCC->CR & RCC_CR_HSERDY) == 0);


	RCC->CR |= RCC_CR_PLLON;
	RCC->PLLCFGR |= RCC_PLLCFGR_PLLSRC;
	while((RCC->CR & RCC_CR_PLLRDY) == 0);

	FLASH->ACR & ~(FLASH_ACR_LATENCY);
	FLASH->ACR |= (FLASH_ACR_LATENCY_5WS);
	FLASH->ACR |= FLASH_ACR_PRFTEN;

	RCC->CFGR &= ~(RCC_CFGR_SW);
	RCC->CFGR |= RCC_CFGR_SW_PLL;
	while((RCC->CFGR & RCC_CFGR_SWS_PLL) == 0);

	RCC->CFGR &= ~(RCC_CFGR_HPRE);


	RCC->CFGR &= ~(RCC_CFGR_PPRE1);
	RCC->CFGR |= (RCC_CFGR_PPRE1_DIV4);

	RCC->CFGR &= ~(RCC_CFGR_PPRE2);
	RCC->CFGR |= (RCC_CFGR_PPRE2_DIV2);
}
